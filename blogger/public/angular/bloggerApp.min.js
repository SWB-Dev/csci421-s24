var app = angular.module("bloggerApp", ['ngRoute', 'blogger', 'common']);
angular.
module('bloggerApp').
config(['$routeProvider',
    function config($routeProvider) {
        $routeProvider.
            when('/', {
                template: '<greet-user></greet-user>'
            }).
            when('/blogs', {
                template:'<blog-list></blog-list>'
            }).
            when('/blogs/add', {
                template: '<blog-add></blog-add>'
            }).
            when('/blogs/edit/:blogId', {
                template: '<blog-edit></blog-edit>'
            }).
            when('/blogs/delete/:blogId', {
                template: "<blog-delete></blog-delete>"
            }).
            when('/not-found', {
                template: '<not-found></not-found>'
            }).
            otherwise('/not-found');
    }
]);angular.module('common', []);angular.
    module('common').
    component('notFound', {
        templateUrl: 'common/templates/notfound.template.html',
        controller: function NotFoundController($scope) {
            this.message = 'Not Found!';
        }
    });

angular.
    module('common').
    component('greetUser', {
        templateUrl: 'common/templates/greetuser.template.html',
        controller: function GreetUserController($scope) {
            this.title = "Steven Barnes";
        }
    });

angular.
    module('common').
    component('navigation',{
        templateUrl: 'common/navigation/navigation.template.html'
    });angular.
    module('bloggerApp').
    service('bloggerData', bloggerData);

bloggerData.$inject = ['$http'];
function bloggerData ($http) {
    var getOneBlog = function(blogId) {
        return $http.get('/api/blog/' + blogId);
    };

    var getAllBlogs = function () {
        var data =  $http.get('/api/blog');
        console.log(data);
        return data;
    };

    return {
        getOneBlog : getOneBlog,
        getAllBlogs : getAllBlogs
    };
};angular.module('blogger', []);
angular.
    module('blogger').
    component('blogList', {
        templateUrl: 'blogger/templates/bloglist.template.html',
        controller: function BlogListController ($scope, $http) {
            var ctrl = this;
            ctrl.title = "View Blogs";
            $http.get('/api/blog')
                .then((value) => {
                    console.log(value);
                    ctrl.data = value.data;
                })
                .catch((e) => console.log(e));
        }
    });

angular.
    module('blogger').
    component('blogAdd', {
        templateUrl: 'blogger/templates/addblog.template.html',
        controller: function BlogAddController ($scope, $http, $location) {
            var ctrl = this;
            ctrl.title = 'Add Blog';
            ctrl.onSubmit = function () {
                console.log(ctrl.formData);
                $http.post('/api/blog/add', ctrl.formData)
                    .then((v) => {
                        $location.path('/blogs')
                    })
                    .catch((e) => console.log(e));
            };
        }
    });

angular.
    module('blogger').
    component('blogEdit', {
        templateUrl: 'blogger/templates/editblog.template.html',
        controller: function BlogEditController ($scope, $routeParams, $http, $location) {
            var ctrl = this;
            ctrl.title = "Edit Blog";
            ctrl.blogId = $routeParams.blogId;
            console.log(ctrl.blogId);
            $http.get('/api/blog/' + ctrl.blogId)
                .then((value) => {
                    console.log(value);
                    ctrl.blog = value.data;
                    ctrl.formData = ctrl.blog;
                })
                .catch((e) => console.log(e));
            
            ctrl.onSubmit = function () {
                console.log(ctrl.formData);
                $http.put('/api/blog/'+ctrl.blogId, ctrl.formData)
                    .then((value) => {
                        console.log(value);
                        ctrl.blog = value.data;
                        ctrl.formData.blogTitle = ctrl.blog.blogTitle;
                        ctrl.formData.blogText = ctrl.blog.blogText;
                        $location.path('/blogs');
                    })
                    .catch((e) => console.log(e));
            };

            ctrl.onCancel = function () {
                $location.path('/blogs');
            };
        }
    });

angular.
    module('blogger').
    component('blogDelete', {
        templateUrl: 'blogger/templates/deleteblog.template.html',
        controller: function BlogDeleteController ($scope, $routeParams, $http, $location) {
            var ctrl = this;
            ctrl.title = "Delete Blog";
            ctrl.blogId = $routeParams.blogId;
            console.log(ctrl.blogId);
            $http.get('/api/blog/' + ctrl.blogId)
                .then((value) => {
                    console.log(value);
                    ctrl.blog = value.data;
                    ctrl.formData = ctrl.blog;
                })
                .catch((e) => console.log(e));
            
            ctrl.onSubmit = function () {
                console.log(ctrl.formData);
                $http.delete('/api/blog/'+ctrl.blogId)
                    .then((value) => {
                        console.log(value);
                        $location.path('/blogs');
                    })
                    .catch((e) => console.log(e));
            };

            ctrl.onCancel = function () {
                $location.path('/blogs');
            };
        }
    });