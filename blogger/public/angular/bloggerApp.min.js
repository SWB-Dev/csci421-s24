var app = angular.module("bloggerApp", ['ngRoute', 'blogger', 'common']);
angular.
module('bloggerApp').
config(['$routeProvider',
    function config($routeProvider) {
        $routeProvider.
            when('/', {
                template: '<greet-user></greet-user>'
            }).
            when('/blogs', {
                template:'<blog-list></blog-list>'
            }).
            when('/blogs/add', {
                template: '<blog-add></blog-add>'
            }).
            when('/not-found', {
                template: '<not-found></not-found>'
            }).
            otherwise('/not-found');
    }
]);angular.module('common', []);angular.
    module('common').
    component('notFound', {
        templateUrl: 'common/templates/notfound.template.html',
        controller: function NotFoundController($scope) {
            this.message = 'Not Found!';
        }
    });

angular.
    module('common').
    component('greetUser', {
        templateUrl: 'common/templates/greetuser.template.html',
        controller: function GreetUserController($scope) {
            this.user = 'world';
        }
    });

angular.
    module('common').
    component('navigation',{
        templateUrl: 'common/navigation/navigation.template.html'
    });angular.
    module('bloggerApp').
    service('bloggerData', bloggerData);

bloggerData.$inject = ['$http'];
function bloggerData ($http) {
    var getOneBlog = function(blogId) {
        return $http.get('/api/blog/' + blogId);
    };

    var getAllBlogs = function () {
        var data =  $http.get('/api/blog');
        console.log(data);
        return data;
    };

    return {
        getOneBlog : getOneBlog,
        getAllBlogs : getAllBlogs
    };
};
angular.module('blogger', []);
// angular.
//     module('bloggerApp').
//     controller('BlogListController', BlogListController);

// BlogListController.$inject = ['bloggerData'];
// function BlogListController ($scope, bloggerData) {
//     var ctrl = this;
//     ctrl.data = bloggerData.getAllBlogs()
//         .success((data) => {
//             ctrl.data = data;
//         })
//         .error((e) => console.log(e));
// };

angular.
    module('blogger').
    component('blogList', {
        templateUrl: 'blogger/templates/bloglist.template.html',
        controller: function BlogListController ($scope, $http) {
            var ctrl = this;
            $http.get('/api/blog')
                .then((value) => {
                    console.log(value);
                    ctrl.data = value.data;
                })
                .catch((e) => console.log(e));
        }
    });

angular.
    module('blogger').
    component('blogAdd', {
        templateUrl: 'blogger/templates/addblog.template.html',
        controller: function BlogAddController ($scope, $http, $location) {
            var ctrl = this;
            ctrl.title = 'Add Blog';
            ctrl.onSubmit = function () {
                console.log(ctrl.formData);
                $http.post('/api/blog/add', ctrl.formData)
                    .then((v) => {
                        $location.path('/blogs')
                    })
                    .catch((e) => console.log(e));
            };
        }
    });